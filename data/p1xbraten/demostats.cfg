recordnextdemostats = [
    demostart = [
        intermission = [
            local csvname cn potentials dealts
            csvname = (format "%1.csv" $demofilename)
            appendline $csvname "cn,name,chainsaw potential,shotgun potential,minigun potential,rockets potenial,rifle potential,grenades potential,pistol potential,chainsaw damage dealt,shotgun damage dealt,minigun damage dealt,rockets potenial,rifle damage dealt,grenades damage dealt,pistol damage dealt"
            looplist cn (listclients 0 0 0) [
                potentials = (format "%1,%2,%3,%4,%5,%6,%7" (getdamagepotential $cn 0) (getdamagepotential $cn 1) (getdamagepotential $cn 2) (getdamagepotential $cn 3) (getdamagepotential $cn 4) (getdamagepotential $cn 5) (getdamagepotential $cn 6) (getdamagepotential $cn 7))
                dealts = (format "%1,%2,%3,%4,%5,%6,%7" (getdamagedealt $cn 0) (getdamagedealt $cn 1) (getdamagedealt $cn 2) (getdamagedealt $cn 3) (getdamagedealt $cn 4) (getdamagedealt $cn 5) (getdamagedealt $cn 6) (getdamagedealt $cn 7))
                appendline $csvname (format "%1,%2,%3,%4" $cn (getclientname $cn) $potentials $dealts)
            ]
        ]
        sleep 100 [ seekdemo "-0:00" ]
    ]
    demoend = [
        intermission = []
        demostart = []
        demoend = []
    ]
]

// demostats expects the name of a directory containing .dmo files to analyze.
// it loads each demo and writes damage dealt and damage potential per-weapon, per-player stats (at intermission) to a CSV file, then continues with the next demo.
//
// example: /demostats "demo/tourney-2020-02"
demostats = [
    local fname defertime
    defertime = 0
    loopfiles fname $arg1 "dmo" [
        sleep $defertime [
            recordnextdemostats
            demo @fname
        ]
        defertime = (+ $defertime 5000)
    ]
]